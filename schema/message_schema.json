{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://agentic.sentient.io/schemas/agent-message-v1",
  "title": "Agent Message Schema",
  "description": "JSON Schema for validating the mandatory message format used for communication between all agents within the Sentient Agentic AI Platform. All agent communications must adhere to this structure for inter-agent message passing.",
  "version": "1.3.0",
  "lastUpdated": "2026-02-23",
  "type": "object",
  "required": [
    "message_id",
    "timestamp",
    "agent",
    "input",
    "output",
    "next_agent",
    "status",
    "error",
    "metadata",
    "resources",
    "audit"
  ],
  "properties": {
    "message_id": {
      "type": "string",
      "description": "Unique identifier for this message (UUID format recommended)",
      "minLength": 1
    },
    "timestamp": {
      "type": "object",
      "description": "Timestamp information for agent execution",
      "required": [
        "executed_at",
        "timezone"
      ],
      "properties": {
        "executed_at": {
          "type": "string",
          "description": "ISO 8601 formatted datetime when agent executed",
          "format": "date-time"
        },
        "timezone": {
          "type": "string",
          "description": "Timezone identifier (e.g., 'Asia/Singapore', 'UTC')",
          "minLength": 1
        }
      },
      "additionalProperties": false
    },
    "agent": {
      "type": "object",
      "description": "Information about the agent producing this message",
      "required": [
        "name",
        "type"
      ],
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the agent producing this message",
          "minLength": 1
        },
        "type": {
          "type": "string",
          "description": "Agent's core layer classification",
          "enum": [
            "governance",
            "operational",
            "executional"
          ]
        }
      },
      "additionalProperties": false
    },
    "input": {
      "type": "object",
      "description": "Input information received by this agent",
      "required": [
        "source",
        "content"
      ],
      "properties": {
        "source": {
          "type": "string",
          "description": "Source of input - 'user' or name of previous agent",
          "minLength": 1
        },
        "content": {
          "description": "The actual input received by this agent",
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "object"
            },
            {
              "type": "array"
            },
            {
              "type": "null"
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "output": {
      "type": "object",
      "description": "Output information produced by this agent",
      "required": [
        "content",
        "content_type"
      ],
      "properties": {
        "content": {
          "description": "The output/recommendation produced by this agent",
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "array"
            },
            {
              "type": "object",
              "properties": {
                "tasks": {
                  "type": "array",
                  "description": "Optional DAG tasks schema for planning outputs",
                  "items": {
                    "type": "object",
                    "required": [
                      "id",
                      "action",
                      "capability_ids",
                      "weight",
                      "dependencies"
                    ],
                    "properties": {
                      "id": {
                        "type": "string",
                        "pattern": "^task_[0-9]+$"
                      },
                      "action": {
                        "type": "string"
                      },
                      "capability_ids": {
                        "type": "array",
                        "items": {
                          "type": "string",
                          "pattern": "^CAP-[A-Z]{3}-[A-Z]?\\d{3}$"
                        }
                      },
                      "weight": {
                        "type": "integer"
                      },
                      "dependencies": {
                        "type": "array",
                        "items": {
                          "type": "string",
                          "pattern": "^task_[0-9]+$"
                        }
                      }
                    }
                  }
                },
                "execution_groups": {
                  "type": "object",
                  "description": "Optional DAG execution groups schema for planning outputs",
                  "patternProperties": {
                    "^[0-9]+$": {
                      "type": "object",
                      "required": [
                        "tasks",
                        "description",
                        "parallel"
                      ],
                      "properties": {
                        "tasks": {
                          "type": "array",
                          "items": {
                            "type": "string",
                            "pattern": "^task_[0-9]+$"
                          }
                        },
                        "description": {
                          "type": "string"
                        },
                        "parallel": {
                          "type": "boolean"
                        }
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "content_type": {
          "type": "string",
          "description": "Type/classification of output (e.g., 'objectives', 'goals', 'plan', 'analysis', 'error')",
          "minLength": 1
        }
      },
      "additionalProperties": false
    },
    "next_agent": {
      "type": "object",
      "description": "Information about the next agent in the execution chain",
      "required": [
        "name",
        "reason"
      ],
      "properties": {
        "name": {
          "description": "Name of the next agent to execute",
          "oneOf": [
            {
              "type": "string",
              "minLength": 1
            },
            {
              "type": "null"
            }
          ]
        },
        "reason": {
          "type": "string",
          "description": "Brief explanation for why this agent is next in the chain",
          "minLength": 1
        }
      },
      "additionalProperties": false
    },
    "status": {
      "type": "object",
      "description": "Status information for this agent's processing",
      "required": [
        "code",
        "message"
      ],
      "properties": {
        "code": {
          "type": "string",
          "description": "Status code indicating the result of processing",
          "enum": [
            "success",
            "partial",
            "failed",
            "pending"
          ]
        },
        "message": {
          "type": "string",
          "description": "Human-readable status description",
          "minLength": 1
        }
      },
      "additionalProperties": false
    },
    "error": {
      "type": "object",
      "description": "Error information if processing encountered issues",
      "required": [
        "has_error",
        "error_code",
        "error_message",
        "retry_count",
        "recoverable"
      ],
      "properties": {
        "has_error": {
          "type": "boolean",
          "description": "True if an error occurred during processing"
        },
        "error_code": {
          "description": "Error code classification (null if no error)",
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "OUT_OF_SCOPE",
                "INVALID_INPUT",
                "PROCESSING_ERROR",
                "TIMEOUT",
                "DEPENDENCY_ERROR",
                "VALIDATION_ERROR"
              ]
            },
            {
              "type": "null"
            }
          ]
        },
        "error_message": {
          "description": "Error description or explanation (null if no error)",
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        },
        "retry_count": {
          "type": "integer",
          "description": "Number of retry attempts made",
          "minimum": 0
        },
        "recoverable": {
          "type": "boolean",
          "description": "Whether the error can be recovered from"
        }
      },
      "additionalProperties": false
    },
    "metadata": {
      "type": "object",
      "description": "Metadata for tracking and tracing message through the system",
      "required": [
        "session_id",
        "request_id",
        "sequence_number",
        "parent_message_id"
      ],
      "properties": {
        "session_id": {
          "type": "string",
          "description": "Identifier for the current execution session",
          "minLength": 1
        },
        "request_id": {
          "type": "string",
          "description": "Identifier linking back to original user request",
          "minLength": 1
        },
        "sequence_number": {
          "type": "integer",
          "description": "Position in the agent execution chain (starts at 1)",
          "minimum": 1
        },
        "parent_message_id": {
          "description": "message_id of the previous agent's message (null for first agent in chain)",
          "oneOf": [
            {
              "type": "string",
              "minLength": 1
            },
            {
              "type": "null"
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "resources": {
      "type": "object",
      "description": "Structured resource references for tracking source URLs, storage locations, and derived assets through the agent chain",
      "required": [
        "source_refs",
        "storage_refs",
        "derived_refs"
      ],
      "properties": {
        "source_refs": {
          "type": "array",
          "description": "URLs and file paths originally provided by the user or extracted from user input",
          "items": {
            "type": "object",
            "required": [
              "ref_id",
              "url",
              "platform",
              "media_type",
              "provided_by",
              "extracted_at_sequence"
            ],
            "properties": {
              "ref_id": {
                "type": "string",
                "description": "Unique reference identifier (e.g., 'src_1', 'src_2')",
                "pattern": "^src_[0-9]+$"
              },
              "url": {
                "type": "string",
                "description": "The original URL or file path"
              },
              "platform": {
                "type": "string",
                "description": "Source platform identifier (e.g., 'youtube', 'instagram', 'tiktok', 'upload')"
              },
              "media_type": {
                "type": "string",
                "description": "Media type (e.g., 'video', 'audio', 'image')"
              },
              "provided_by": {
                "type": "string",
                "description": "Who provided the URL — 'user' or agent name"
              },
              "extracted_at_sequence": {
                "type": "integer",
                "description": "Sequence number of the agent that extracted and assigned this ref ID",
                "minimum": 1
              }
            },
            "additionalProperties": false
          }
        },
        "storage_refs": {
          "type": "array",
          "description": "Platform storage locations (e.g., Wasabi) for acquired content",
          "items": {
            "type": "object",
            "required": [
              "ref_id",
              "source_ref_id",
              "storage_uri",
              "storage_backend",
              "media_type",
              "created_at_sequence",
              "status"
            ],
            "properties": {
              "ref_id": {
                "type": "string",
                "description": "Unique reference identifier (e.g., 'store_1', 'store_2')",
                "pattern": "^store_[0-9]+$"
              },
              "source_ref_id": {
                "type": "string",
                "description": "The source_ref this storage object was acquired from (e.g., 'src_1')",
                "pattern": "^src_[0-9]+$"
              },
              "storage_uri": {
                "description": "The storage URI once the asset is stored (null while pending)",
                "oneOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ]
              },
              "storage_backend": {
                "type": "string",
                "description": "Storage system identifier (e.g., 'wasabi')"
              },
              "media_type": {
                "type": "string",
                "description": "Media type of the stored asset"
              },
              "created_at_sequence": {
                "description": "Sequence number of the agent that created this storage entry (null while pending)",
                "oneOf": [
                  {
                    "type": "integer",
                    "minimum": 1
                  },
                  {
                    "type": "null"
                  }
                ]
              },
              "status": {
                "type": "string",
                "description": "Current status of the storage reference",
                "enum": [
                  "pending",
                  "stored",
                  "failed"
                ]
              }
            },
            "additionalProperties": false
          }
        },
        "derived_refs": {
          "type": "array",
          "description": "Intermediate assets derived from stored content (e.g., extracted audio tracks, frame sets)",
          "items": {
            "type": "object",
            "required": [
              "ref_id",
              "parent_ref_id",
              "storage_uri",
              "asset_type",
              "capability_id",
              "created_at_sequence",
              "status"
            ],
            "properties": {
              "ref_id": {
                "type": "string",
                "description": "Unique reference identifier (e.g., 'derived_1', 'derived_2')",
                "pattern": "^derived_[0-9]+$"
              },
              "parent_ref_id": {
                "type": "string",
                "description": "The ref_id this asset was derived from (e.g., 'store_1')"
              },
              "storage_uri": {
                "description": "The storage URI once the asset is created (null while pending)",
                "oneOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ]
              },
              "asset_type": {
                "type": "string",
                "description": "Type of derived asset (e.g., 'audio_track', 'frame_set', 'transcript')"
              },
              "capability_id": {
                "type": "string",
                "description": "The capability that produces this asset (e.g., 'CAP-PRE-002')",
                "pattern": "^CAP-[A-Z]{3}-[A-Z]?\\d{3}$"
              },
              "created_at_sequence": {
                "description": "Sequence number of the agent that registered this derived ref (null while pending)",
                "oneOf": [
                  {
                    "type": "integer",
                    "minimum": 1
                  },
                  {
                    "type": "null"
                  }
                ]
              },
              "status": {
                "type": "string",
                "description": "Current status of the derived asset",
                "enum": [
                  "pending",
                  "created",
                  "failed"
                ]
              }
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    },
    "audit": {
      "type": "object",
      "description": "Audit and compliance information for governance tracking",
      "required": [
        "compliance_notes",
        "governance_files_consulted",
        "reasoning"
      ],
      "properties": {
        "compliance_notes": {
          "type": "string",
          "description": "Governance compliance observations, validations performed, and any flags",
          "minLength": 1
        },
        "governance_files_consulted": {
          "type": "array",
          "description": "List of governance files referenced during processing",
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "reasoning": {
          "type": "string",
          "description": "Chain of Thought explaining why decisions were made — the rationale behind routing, scope validation, output choices, and any trade-offs considered",
          "minLength": 1
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}