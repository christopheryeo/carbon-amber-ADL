# Agent-Application Separation Phase 2 Audit

**Date:** 2026-02-23
**Reference:** `plans/2026-02-23-plans.md` — Priority 1 (Items 1.7–1.11)

This document tracks the progress and verification of Phase 1 and Phase 2 of the Agent-Application Separation refactoring (tasks 1.1 through 1.11). The primary goal is to verify that these files are completely decoupled from the specific DSTA video-analysis application constraints before closing out Priority 1.

---

## Phase 1: Operational & Executional Core Separation

## 1.1 Refactor `planning.md` Generic Rules
**Status:** ✅ Done
**Files:** `agent/operational/planning.md`
**Objective:** Remove video-specific dependency, weight, and ref assignment rules.
**Verification Checklist:**
- [x] Video-specific Dependency Rules table replaced with generic rules referencing `application.md`
- [x] Weight table and Ref Assignment Rules genericised

## 1.2 Refactor `action.md` Tool Mapping
**Status:** ✅ Done
**Files:** `agent/executional/action.md`, `context/application.md`
**Objective:** Move capability-to-tool mapping to `application.md`.
**Verification Checklist:**
- [x] CAP-to-MCP tool mapping table removed from `action.md`
- [x] Mapping table migrated to `application.md`

## 1.3 Refactor `dispatch.md` Retry Scenarios
**Status:** ✅ Done
**Files:** `agent/operational/dispatch.md`
**Objective:** Genericise examples and retry scenarios.
**Verification Checklist:**
- [x] Hardcoded URIs (Wasabi/YouTube) replaced with generic `storage://...` placeholders
- [x] Tool-specific retry examples genericised

## 1.4 Refactor `reasoning.md`
**Status:** ✅ Done
**Files:** `agent/operational/reasoning.md`
**Objective:** Genericise examples.
**Verification Checklist:**
- [x] Wasabi URIs removed and replaced with generic ref placeholders
- [x] Example outputs genericised to abstract domain terminology

## 1.5 Refactor `memory.md` Knowledge Examples
**Status:** ✅ Done
**Files:** `agent/operational/memory.md`
**Objective:** Genericise knowledge examples.
**Verification Checklist:**
- [x] Hardcoded platform names (TikTok, YouTube, Instagram) removed
- [x] Video analysis domain examples replaced with generic equivalents

## 1.6 Verify `objective.md` and `goal.md`
**Status:** ✅ Done
**Files:** `agent/governance/objective.md`, `agent/governance/goal.md`
**Objective:** Verify initial genericisation of governance agents.
**Verification Checklist:**
- [x] `objective.md` and `goal.md` checked for application-specific content
- [x] Phase 2 items (1.7-1.11) created to handle deeper refactoring

---

## Phase 2: Governance & Schema Separation

## 1.7 Refactor `goal.md` Patterns
**Status:** ✅ Done
**Files:** `agent/governance/goal.md`, `context/application.md`
**Objective:** Move deeply-coupled video-specific patterns (Patterns A–J) to the application context.
**Verification Checklist:**
- [x] Patterns A-J removed from `agent/governance/goal.md`
- [x] Placeholder added to `agent/governance/goal.md` pointing to `application.md`
- [x] Patterns A-J successfully migrated to `context/application.md` as "Goal Decomposition Patterns"

## 1.8 Refactor `action.md` Governance Path & Defaults
**Status:** ✅ Done
**Files:** `agent/executional/action.md`, `context/application.md`
**Objective:** Fix the broken governance file path parameter and remove default execution parameters (e.g. sample rates, output formats).
**Verification Checklist:**
- [x] Canonical governance path updated from `"agent/executional/execution.md"` to `"agent/executional/action.md"`
- [x] Hardcoded parameter defaults (e.g., wav, 16000Hz, 1.0s interval) removed from `action.md`
- [x] Default parameters documented in `context/application.md` instead

## 1.9 Refactor `objective.md` & `goal.md` Scope Validation
**Status:** ✅ Done
**Files:** `agent/governance/objective.md`, `agent/governance/goal.md`
**Objective:** Generalise the scope validation lists by pointing them to `application.md` instead of hardcoding expected in-scope capabilities.
**Verification Checklist:**
- [x] `objective.md` scope validation replaced with generic verbiage referencing `application.md`
- [x] `objective.md` genericised "video content" language (e.g. replaced with "source content")
- [x] `goal.md` scope validation replaced with generic verbiage referencing `application.md`

## 1.10 Refactor `reasoning.md` Output Schemas
**Status:** ✅ Done
**Files:** `agent/operational/reasoning.md`, `context/application.md`
**Objective:** Move the extremely detailed and application-specific CAP-SYN output schemas into the application context.
**Verification Checklist:**
- [x] Detailed synthesis output schemas (for CAP-SYN-001, CAP-SYN-002, etc.) removed from `reasoning.md`
- [x] `reasoning.md` restructured to instruct the agent to retrieve output schemas from `application.md`
- [x] Schemas successfully migrated to `context/application.md`

## 1.11 Refactor `objective.md` Capability Mapping
**Status:** ✅ Done
**Files:** `agent/governance/objective.md`
**Objective:** Replace the hardcoded capability mapping table in the Objective Agent with a reference to the equivalent section in the application context.
**Verification Checklist:**
- [x] Hardcoded capability mapping table (e.g. audio analysis, visual analysis categories) removed from `objective.md`
- [x] `objective.md` instructs the agent to consult `application.md` for capability categories and their identifiers

---

## Final Audit: Agent-Application Separation Completeness

An automated grep search of the `agent/` directory was conducted to verify that no application-specific constraints, tools, or domain terminology (e.g., specific capabilities, video-processing patterns, tool names) remained hardcoded in the agent definitions.

### Findings

1. **Structural Separation (SUCCESS):**
   - All rules dictating capability prerequisites, capability-to-tool mappings, parameter defaults, task weighting, and ref ID assignments have been successfully extracted and moved to `context/application.md`.
   - The agents now purely focus on their operational logic (e.g., parsing, DAG construction, MCP invocation) and defer all domain-specific definitions to the application context.

2. **Cosmetic Domain Leakage (MINOR):**
   - While the rules are generic, the *examples* used to teach the agents how to format their output still rely on video-analysis terminology.
   - For instance, `objective.md` still uses examples like `"Obtain video content from src_1..."` and explicitly lists "yt-dlp", "YOLO model", and "Whisper-X" in its "Common Mistakes" section (as examples of what *not* to do).
   - `action.md` still uses `.mp4` as an example format in its payload snippets.
   - `dispatch.md` uses `https://example-source.com/video` as a placeholder URL.

### Conclusion

The **functional coupling** between the agents and the video analysis application has been completely severed. The system now supports "swapping out" `application.md` to suddenly make the swarm handle document processing or cyber-security analysis without changing the agent logic.

The remaining "video" mentions are purely illustrative examples that do not constrain the agent's behavior. We consider Priority 1 (Agent-Application Separation) to be functionally complete, although a future polish pass could abstract the examples to use generic terms like `"Obtain source content"` and `"data_extraction_tool"`.

---

## Priority 5: Planning Agent Fixes

**Status:** ✅ Done
**Files:** `agent/operational/planning.md`

### Audit Results

- **5.1, 5.2, 5.3 (Tables updates):** Resolved implicitly by Phase 1 genericisation. The application-specific tables (weights, dependencies, ref assignments) were removed from `planning.md` and moved to `application.md`. Verification confirmed `planning.md` now generically defers to `application.md` Section 6 and 7.
- **5.4 (Complete Example 2 DAG):** Successfully added the full JSON block (13 tasks across 8 execution groups) to Example 2. Language detection is correctly sequenced before transcription.
- **5.5 (Sequential derived_ref numbering):** Added explicitly as Check 3 under the `Pre-Execution Validation (MANDATORY)` section. Added a corresponding rule to `Common Mistakes` (Rule 12).
- **5.6 (message_id prefix convention):** Added a new `message_id Construction Rule (CRITICAL)` instructing the agent to construct its output message ID using `msg-plan-{YYYYMMDD}-{HHMMSS}` to distinguish it from its parent `msg-goal-` IDs.
- **5.7 (Deduplication Log Transparency):** Updated Step 2 ('Deduplicate Goals') to enforce recording objective-level merges. Added Check 4 (`Deduplication Transparency`) to the `Pre-Execution Validation` checklist to mandate a non-empty `deduplication_log` if `total_tasks < raw_goals`.
