# Carbon Amber ADL â€” Improvement Plan for 23 February 2026

**Date:** 2026-02-23
**Prepared by:** Antigravity (AI Assistant)

### Status Legend

| Icon | Status | Meaning |
|------|--------|--------|
| ðŸ†• | New | Not yet started |
| ðŸ”„ | In Progress | Work underway |
| âœ… | Done | Completed |

---

## Status of Previous Plans

### From `carbon-amber-adl Development.md` (Feb 21)

| Phase | Item | Status |
|-------|------|--------|
| Phase 1 | Implement `dispatch_agent` | âœ… Done (`dispatch.md` v1.0.0) |
| Phase 1 | Create unified action agent (was `execution_agent`) | âœ… Done (`action.md` v1.0.0, renamed Feb 23) |
| Phase 1 | Test single-task execution pipeline | âŒ Not yet tested |
| Phase 2 | Dispatch failure handling and retry logic | âœ… Included in `dispatch.md` |
| Phase 2 | Parallel execution group coordination | âœ… Included in `dispatch.md` |
| Phase 2 | Workflow state tracking | âœ… Included in `dispatch.md` |
| Phase 3 | Reposition reasoning_agent for synthesis | âœ… Done (`reasoning.md` v1.0.0) |
| Phase 3 | Deprecate perception_agent and action_agent placeholders | âŒ Placeholder files still exist |
| Phase 3 | Retire interpretation_agent | âŒ Placeholder file still exists |
| Phase 4 | Multi-task workflow testing | âŒ Not yet done |
| Phase 4 | Ref resolution validation | âŒ Not yet done |

---

## What Can Be Done Today

The following items are grouped by priority and ordered by dependency. Each item can be completed in a single working session.

---

### ðŸ”´ Priority 2: HIGH Severity Fixes (from Cross-Reference Report)

These resolve contradictions and broken references that would cause runtime failures or incorrect LLM behaviour.

#### 2.1 ðŸ†• Fix memory agent ID mismatch (Finding A1)
- **Problem:** `memory.md` defines `agent.name` as `"agent_memory"` but `dispatch.md` routes to `"memory_agent"`
- **Action:** Update `memory.md` to use `"memory_agent"` consistently (aligns with all other agent naming: `objective_agent`, `goal_agent`, etc.)
- **Files:** `agent/operational/memory.md`
- **Effort:** ~5 minutes

#### 2.2 ðŸ†• Overhaul `memory.md` output example (Findings D3, D5)
- **Problem:** Output example uses flat field format (`"agent": "agent_memory"`, `"status": "success"`) instead of the nested object structure required by `message_format.md`. Also uses stale 2025 dates.
- **Action:** Rewrite the output example to use nested format (`agent: {name, type}`, `status: {code, message}`), update timestamps to 2026, and include `resources` field
- **Files:** `agent/operational/memory.md`
- **Effort:** ~15 minutes

#### 2.3 ðŸ†• Remove "Reviewer Agent" references (Finding A4)
- **Problem:** `memory.md` references a "Reviewer Agent" that doesn't exist in the architecture
- **Action:** Remove/replace all references to "Reviewer Agent" with appropriate alternatives (e.g., quality benchmarks derived from audit data rather than a separate agent)
- **Files:** `agent/operational/memory.md`
- **Effort:** ~10 minutes

#### 2.4 ðŸ†• Update `message_format.md` examples (Findings D1, D2)
- **Problem:** Example 1 Objective Agent output is missing URL annotations on `src_N`. Example 2 Goal Agent output is missing mandatory language detection goal before transcription.
- **Action:** Update both examples to conform to current `objective.md` v1.4.0 and `goal.md` v1.7.0 rules
- **Files:** `context/governance/message_format.md`
- **Effort:** ~20 minutes

#### 2.5 ðŸ†• Add CAP-AUD-R to Agent Chain Flow (Finding C1)
- **Problem:** Agent Chain Flow in `message_format.md` lists Action Agent capabilities but omits `CAP-AUD-R` (audience analysis)
- **Action:** Add `CAP-AUD-R` to the capability list at steps [4]â€“[5]
- **Files:** `context/governance/message_format.md`
- **Effort:** ~5 minutes

#### 2.6 ðŸ†• Update `message_schema.json` to catch up with `message_format.md` (Findings E1, B1)
- **Problem:** Schema is at v1.2.0 (Feb 19) while spec is at v1.6.0 (Feb 20). Any fields or constraints added since v1.2.0 are not enforced.
- **Action:** Audit changes from v1.3.0â€“v1.6.0 in `message_format.md` changelog and update the JSON schema accordingly
- **Files:** `schema/message_schema.json`, reference `context/governance/message_format.md`
- **Effort:** ~30 minutes

---

### ðŸŸ¡ Priority 3: MEDIUM Severity Fixes

These address staleness, naming inconsistencies, and documentation gaps.

#### 3.1 ðŸ†• Delete deprecated placeholder files (Finding B3)
- **Problem:** `perception.md` and `interpretation.md` (both v0.1.0, Feb 9) are stale placeholders superseded by the new `action.md` and `reasoning.md`
- **Action:** `git rm` both files. They serve no purpose and may confuse LLMs or developers.
- **Files:** `agent/executional/perception.md`, `agent/executional/interpretation.md`
- **Effort:** ~2 minutes

#### 3.2 ðŸ†• Update `instructions.md` (Finding B2)
- **Problem:** `instructions.md` v2.0.0 (Feb 10) predates the Dispatch Agent, Reasoning Agent, and Action Agent (all Feb 21). The prompt assembly contract doesn't mention these newer agents.
- **Action:** Update the valid agent file list in Step 2 to include `dispatch.md`, `reasoning.md`, the renamed `action.md`, and note the removal of `perception.md`/`interpretation.md`
- **Files:** `context/instructions.md`
- **Effort:** ~10 minutes

#### 3.3 ðŸ†• Standardise CAP-AUD-R identifier format (Finding A2)
- **Problem:** Inconsistent format â€” `application.md` uses `CAP-AUD-R001`, `goal.md` uses `CAP-AUD-Rxxx`, `dispatch.md` uses `CAP-AUD-R*`
- **Action:** Standardise on `CAP-AUD-R001` format (matches existing capability ID pattern) across all files
- **Files:** `context/application.md`, `agent/governance/goal.md`, `agent/operational/dispatch.md`, `agent/operational/planning.md`
- **Effort:** ~10 minutes

#### 3.4 ðŸ†• Fix `memory.md` orchestration naming (Finding A3)
- **Problem:** `memory.md` references "ARL" while other files use "n8n"
- **Action:** Replace all "ARL" references with "n8n" or "orchestration layer" for consistency
- **Files:** `agent/operational/memory.md`
- **Effort:** ~5 minutes

#### 3.5 ðŸ†• Fix `memory.md` log path convention (Finding D4)
- **Problem:** `memory.md` references `system/logs/txn_20250601_001.jsonl` (transaction-based JSONL) but `audit.md` specifies `system/logs/YYYYMMDD.md` (date-based markdown)
- **Action:** Update `memory.md` examples to use the correct date-based path convention
- **Files:** `agent/operational/memory.md`
- **Effort:** ~5 minutes

#### 3.6 ðŸ†• Update `application_template.md` (Finding B5)
- **Problem:** Template v1.0.0 (Feb 9) is outdated: missing Planning Agent, Dispatch Agent, and uses old agent names
- **Action:** Update template to reflect current architecture (all 7 active agents, correct naming)
- **Files:** `template/application_template.md`
- **Effort:** ~20 minutes

#### 3.7 ðŸ†• Add schema validation for capability IDs and DAG structure (Findings E4, E5, E6)
- **Problem:** `message_schema.json` doesn't validate CAP-ID format or DAG task structure
- **Action:** Add pattern validation for capability IDs (`CAP-[A-Z]{3}-[A-Z]?\\d{3}`) and optional DAG task schema
- **Files:** `schema/message_schema.json`
- **Effort:** ~20 minutes

---

### ðŸŸ¢ Priority 4: Cleanup and Documentation

#### 4.1 ðŸ†• Fix `goal.md` Common Mistakes numbering (Finding A5)
- **Problem:** Numbering is non-sequential (1â€“6, jumps to 10, 11, back to 7, 8, 9, then 12, 13)
- **Action:** Renumber sequentially
- **Files:** `agent/governance/goal.md`
- **Effort:** ~5 minutes

#### 4.2 ðŸ†• Document or remove `memory.md` undefined concepts (Finding C3)
- **Problem:** `memory.md` references "circuit breaker", "10-hop limit", and "SLM to LLM escalation" not defined elsewhere
- **Action:** Either add definitions to a shared glossary section in `application.md` or `README.md`, or remove if obsolete
- **Files:** `agent/operational/memory.md`, potentially `README.md`
- **Effort:** ~10 minutes

#### 4.3 ðŸ†• Update `README.md` Version History
- **Problem:** Version history ends at v2.3.0 (Feb 20) and doesn't reflect the architecture restructure (dispatch agent, action agent rename, reasoning agent repositioning)
- **Action:** Add v2.4.0 entry documenting the Feb 21â€“23 changes
- **Files:** `README.md`
- **Effort:** ~10 minutes

#### 4.4 ðŸ†• Update `cross-reference analysis-report.md`
- **Problem:** Report still references `execution_agent` and `execution.md` (now renamed)
- **Action:** Update the file inventory table and finding descriptions to reflect the `action_agent` rename. Mark any resolved findings.
- **Files:** `plans/cross-reference analysis-report.md`
- **Effort:** ~10 minutes

#### 4.5 ðŸ†• Clean up `.claude/worktrees`
- **Problem:** Stale worktree `confident-newton` is an old repo snapshot taking up space
- **Action:** Delete `.claude/worktrees/confident-newton/` directory; add `.claude/` to `.gitignore`
- **Effort:** ~2 minutes

---

### ðŸŸ  Priority 5: Planning Agent Fixes (from Functionality Review â€” Feb 23)

These address gaps in `planning.md` found by cross-referencing against `application.md` capabilities.

#### 5.1 âœ… Fix language detection â†’ transcription dependency (Issue P1)
- **Problem:** `planning.md` Dependency Rules table lists Transcription and Language Detection as independent parallel tasks. `application.md` mandates: `CAP-PRE-002 â†’ CAP-AUD-004 â†’ CAP-AUD-001` (extract audio â†’ detect language â†’ transcribe)
- **Action:** Update Dependency Rules table so Transcription depends on Language Detection AND Audio Extraction. Update Example 1 to include a language detection task before transcription.
- **Files:** `agent/operational/planning.md`
- **Effort:** ~15 minutes

#### 5.2 ðŸ”„ Complete the weight table (Issue P2)
- **Problem:** `estimated_weight` table (Step 8) missing 12 capabilities: CAP-ACQ-003/004/005, CAP-PRE-004/005, CAP-AUD-005, CAP-AUD-R001/R002/R003, CAP-SYN-003, CAP-DAT-001/002/003
- **Action:** Add weight assignments for all missing capabilities
- **Files:** `agent/operational/planning.md`
- **Effort:** ~10 minutes

#### 5.3 ðŸ”„ Complete the dependency rules table (Issue P3)
- **Problem:** Dependency Rules table (Step 5) missing 10 task types: CAP-AUD-005, CAP-SPK-002/003, CAP-AUD-R001/R002/R003, CAP-VIS-004/005/007, CAP-DAT-*
- **Action:** Add dependency rules for all missing task types, cross-referenced against `application.md` Section 6.8
- **Files:** `agent/operational/planning.md`
- **Effort:** ~20 minutes

#### 5.4 ðŸ”„ Add full workflow output to Example 2 (Issue P4)
- **Problem:** Example 2 (Multi-Objective With Deduplication) shows input and deduplication analysis but no full workflow output JSON
- **Action:** Add the complete Planning Agent output showing the 13-task DAG with execution groups, language detection sequencing, and full deduplication merge
- **Files:** `agent/operational/planning.md`
- **Effort:** ~30 minutes

#### 5.5 ðŸ†• Enforce sequential derived_ref numbering (Log Validation â€” Feb 23)
- **Problem:** In log `20260223-1.md` Chain 1, the Planning Agent registered derived_1, derived_3, derived_4 â€” skipping derived_2. Per `message_format.md`, derived_ref IDs must follow sequential conventions (`derived_1`, `derived_2`, `derived_3`â€¦) with no gaps.
- **Action:** Add an explicit validation step to the Planning Agent's Pre-Execution Validation checklist (Step 12) that verifies all registered `derived_ref` IDs are sequentially numbered with no gaps. Add a corresponding entry to the Common Mistakes section. Optionally add an orchestration-layer validation rule in `message_format.md` to catch this.
- **Files:** `agent/operational/planning.md`, optionally `context/governance/message_format.md`
- **Effort:** ~15 minutes

#### 5.6 ðŸ†• Fix Planning Agent message_id prefix convention (Log Validation â€” Feb 23)
- **Problem:** In log `20260223-1.md`, both Planning Agent invocations use message_id prefix `msg-goal-` (e.g., `msg-goal-20260223-124601`) instead of a planning-specific prefix like `msg-plan-`. This reduces traceability in the audit trail and makes it harder to distinguish Planning Agent messages from Goal Agent messages at a glance.
- **Action:** Update the Planning Agent's message_id construction rule in `planning.md` to use the prefix `msg-plan-` instead of `msg-goal-`. Update any examples that show Planning Agent message_ids. Consider adding a Common Mistake entry.
- **Files:** `agent/operational/planning.md`
- **Effort:** ~10 minutes

#### 5.7 ðŸ†• Log objective consolidation in deduplication_log (Log Validation â€” Feb 23)
- **Problem:** In log `20260223-1.md` Chains 1 and 2, the Goal Agent output contained 3 objectives, but the Planning Agent's input shows only 2 (objectives were merged/consolidated). However, the `deduplication_log` array is empty in both cases, meaning this consolidation is undocumented. This breaks audit transparency â€” there is no record of what was merged or why.
- **Action:** Update the Planning Agent's deduplication rules to require that any objective-level merging or goal-level consolidation performed during input processing is recorded in the `deduplication_log` array. Each entry should document the source objectives, the merge rationale, and the resulting consolidated objective. Add a validation step to the Pre-Execution Validation checklist to verify `deduplication_log` is non-empty whenever `total_tasks` differs from the raw goal count.
- **Files:** `agent/operational/planning.md`
- **Effort:** ~20 minutes

---

### ðŸ”µ Priority 1: Agent-Application Separation Refactoring (TOP PRIORITY)

**Principle:** Agent definitions must remain application-agnostic. All application-specific content belongs in `context/application.md`. Swapping `application.md` should enable a completely different application without modifying any agent files.

**Added to `CLAUDE.md`:** âœ… Architectural Principle section added.

#### Scan Results â€” Application-Specific Content Found in Agent Files

| Agent File | Severity | Application-Specific Content Found |
|-----------|----------|-----------------------------------|
| `planning.md` | **HIGH** | Dependency rules table uses video-specific task names (Audio extraction, Transcription, etc.). Weight table references specific CAP-IDs. Ref assignment rules reference specific asset types. Scope validation mentions YouTube/Instagram/TikTok. Examples use video analysis scenario. |
| `action.md` | **HIGH** | Full CAP-to-MCP tool mapping table with tool names (`ffmpeg_audio_extract`, `youtube_downloader`, etc.). Wasabi URIs (`wasabi://dsta-bucket/...`). Examples reference YouTube URLs. |
| `dispatch.md` | **HIGH** | Wasabi URIs in examples. Specific tool names (ffmpeg, Whisper-X, YOLO). YouTube URLs. Platform-specific retry examples (yt-dlp rate limits). CAP-ID routing table with specific capability names. |
| `reasoning.md` | **MEDIUM** | Wasabi URIs in examples. YouTube video analysis in example output. CAP-SYN capability descriptions with video-specific content. |
| `memory.md` | **MEDIUM** | TikTok/YouTube/Instagram in examples and knowledge entries. Video analysis domain knowledge examples. |
| `goal.md` | **LOW** | References to `application.md` Section 6 CAP-ID categories by name â€” this is acceptable since it's a reference, not a hardcoded definition. |
| `objective.md` | **LOW** | Needs verification â€” likely has video analysis examples. |
| `perception.md` | N/A | Deprecated placeholder â€” scheduled for deletion (item 2.1). |
| `interpretation.md` | N/A | Deprecated placeholder â€” scheduled for deletion (item 2.1). |

#### Refactoring Strategy

For each affected agent file, the approach is:

1. **Replace hardcoded task types with generic terminology** â€” e.g., "Audio extraction" â†’ "Pre-processing task" or defer to `application.md` Section 6.9
2. **Replace hardcoded URIs with placeholder patterns** â€” e.g., `wasabi://dsta-bucket/...` â†’ `{storage_backend}://...` or `storage://bucket/session-xxx/...`
3. **Replace platform names with generic references** â€” e.g., "YouTube URL" â†’ "source URL" or "supported platform URL (see `application.md` Section 7)"
4. **Replace tool names with generic descriptions** â€” e.g., "ffmpeg" â†’ "the tool mapped to this capability (see `application.md` Section 6)"
5. **Move CAP-to-tool mappings to `application.md`** â€” the mapping table in `action.md` belongs in `application.md`
6. **Keep examples functional but generic** â€” use placeholder CAP-IDs and abstract descriptions

#### Per-File Refactoring Items

##### 1.1 âœ… Refactor `planning.md` â€” Remove video-specific dependency/weight/ref rules
- **Content to move:** Dependency Rules table (16 video-specific task types), Weight table (video CAP-IDs), Ref Assignment Rules (video asset types)
- **Strategy:** Replace with generic rules that reference `application.md` Section 6.9 for capability dependencies and I/O types. Keep the generic DAG construction algorithm.
- **Files:** `agent/operational/planning.md`, potentially `context/application.md`
- **Effort:** ~45 minutes

##### 1.2 âœ… Refactor `action.md` â€” Move tool mapping to `application.md`
- **Content to move:** CAP-to-MCP tool mapping table (lines ~108â€“130), Wasabi URIs, YouTube URLs
- **Strategy:** Move the mapping table to a new section in `application.md`. Replace with: "Consult `application.md` Section N for the capability-to-tool mapping."
- **Files:** `agent/executional/action.md`, `context/application.md`
- **Effort:** ~30 minutes

##### 1.3 âœ… Refactor `dispatch.md` â€” Genericise examples and retry scenarios
- **Content to move:** Wasabi URIs, YouTube URLs, tool-specific retry examples (ffmpeg, Whisper-X, yt-dlp)
- **Strategy:** Replace URIs with `storage://...` placeholders. Replace tool names with "the invoked tool". Make retry examples generic.
- **Files:** `agent/operational/dispatch.md`
- **Effort:** ~30 minutes

##### 1.4 âœ… Refactor `reasoning.md` â€” Genericise examples
- **Content to move:** Wasabi URIs, video analysis content in example outputs
- **Strategy:** Replace URIs with placeholders. Make example outputs use abstract domain terminology.
- **Files:** `agent/operational/reasoning.md`
- **Effort:** ~20 minutes

##### 1.5 âœ… Refactor `memory.md` â€” Genericise knowledge examples
- **Content to move:** TikTok/YouTube/Instagram platform names, video analysis domain examples
- **Strategy:** Use generic examples (e.g., "platform-specific content restrictions" instead of "TikTok restricted content")
- **Files:** `agent/operational/memory.md`
- **Effort:** ~15 minutes

##### 1.6 âœ… Verify `objective.md` and `goal.md`
- **Action:** Verify these files only reference `application.md` and don't contain hardcoded application content
- **Files:** `agent/governance/objective.md`, `agent/governance/goal.md`
- **Effort:** ~10 minutes

---

## Estimated Total Effort

| Priority | Items | Estimated Time |
|----------|-------|---------------|
| ï¿½ Agent-Application separation (P1) | 6 | ~150 minutes |
| ï¿½ HIGH severity fixes (P2) | 6 | ~85 minutes |
| ï¿½ MEDIUM severity fixes (P3) | 7 | ~70 minutes |
| ðŸŸ¢ Cleanup/docs (P4) | 5 | ~35 minutes |
| ï¿½ Planning Agent fixes (P5) | 7 | ~120 minutes |
| **Total** | **31 items** | **~7.75 hours** |

> **Note:** Priority 1 (agent-app separation) should be done FIRST. Priority 5 items 5.2â€“5.4 should be done AFTER Priority 1, so the planning agent tables are genericised rather than expanded with more application-specific data.

---

## Recommended Execution Order

**Priority 1 (Agent-Application Separation) is the first batch.** After that, items are grouped by shared files.

**Suggested batches:**

1. **Batch A â€” Agent-Application separation** (1.1â€“1.6): Refactor all agent files to remove application-specific content. **START HERE.**
2. **Batch B â€” `memory.md` overhaul** (2.1 + 2.2 + 2.3 + 3.4 + 3.5): Fix ID, overhaul example, remove Reviewer Agent, fix ARL naming, fix log paths
3. **Batch C â€” `message_format.md` updates** (2.4 + 2.5): Fix examples, add CAP-AUD-R
4. **Batch D â€” Delete stale files** (3.1 + 4.5): Remove placeholder agents, clean worktree
5. **Batch E â€” Update supporting docs** (3.2 + 3.6 + 4.3 + 4.4): Update instructions, template, README, cross-ref report
6. **Batch F â€” Schema updates** (2.6 + 3.7): Bring schema up to date
7. **Batch G â€” `planning.md` remaining fixes** (5.2 + 5.3 + 5.4 + 5.5 + 5.6 + 5.7): Complete tables and Example 2 using generic content (post-separation); fix derived_ref numbering gap, message_id prefix, and deduplication_log transparency
8. **Batch H â€” Minor fixes** (3.3 + 4.1 + 4.2): CAP-AUD-R format, goal.md numbering, memory concepts

---

*End of Plan*
